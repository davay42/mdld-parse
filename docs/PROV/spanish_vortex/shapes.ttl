@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix sh:   <http://www.w3.org/ns/shacl#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix tag:  <tag:mdld.js.org,2026:spanish:> .
@prefix ex:   <tag:mdld.js.org,2026:spanish:example:> .
@prefix mdp:  <http://mdld.js.org/prov/> .

# ========================================
# SHACL SHAPES FOR SPANISH VORTEX
# ========================================

# Goal Completion Shape - detects unfinished goals
tag:GoalCompletionShape a sh:NodeShape ;
    sh:targetClass prov:Plan ;
    sh:property [
        sh:path prov:wasDerivedFrom ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Goal must derive from higher-level goal" ;
        sh:severity sh:Violation ;
        sh:message "⚠️ UNFINISHED GOAL: Goal lacks higher-level derivation - create parent goal" ;
    ] ;
    sh:property [
        sh:path prov:wasInformedBy ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Goal must be informed by completed activity" ;
        sh:severity sh:Violation ;
        sh:message "⚠️ UNFINISHED GOAL: No completion activity found - create activity to achieve goal" ;
    ] .

# Plan Execution Shape - detects unexecuted plans
tag:PlanExecutionShape a sh:NodeShape ;
    sh:targetClass prov:Plan ;
    sh:property [
        sh:path prov:wasAssociatedWith ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Plan must be associated with executing agent" ;
        sh:severity sh:Violation ;
        sh:message "⚠️ UNFINISHED PLAN: No executing agent assigned - create activity with qualified association" ;
    ] ;
    sh:property [
        sh:path mdp:hasExecutionActivity ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Plan must have execution activity" ;
        sh:severity sh:Violation ;
        sh:message "⚠️ UNFINISHED PLAN: No execution activity found - create activity to execute plan" ;
    ] .

# Entity Processing Shape - detects unprocessed entities
tag:EntityProcessingShape a sh:NodeShape ;
    sh:targetClass prov:Entity ;
    sh:property [
        sh:path prov:wasUsedBy ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Entity must be used by processing activity" ;
        sh:severity sh:Violation ;
        sh:message "⚠️ UNPROCESSED ENTITY: Entity not used by any activity - create activity to process this entity" ;
    ] ;
    sh:property [
        sh:path prov:specializationOf ;
        sh:minCount 0 ;
        sh:maxCount 0 ;
        sh:description "Unprocessed entities should not have specializations" ;
        sh:severity sh:Warning ;
        sh:message "⚠️ UNPROCESSED ENTITY: Entity has specializations before processing - ensure proper processing order" ;
    ] .

# Activity Generation Shape - ensures activities are created
tag:ActivityGenerationShape a sh:NodeShape ;
    sh:targetClass prov:Entity ;
    sh:property [
        sh:path prov:generated ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Entity must generate at least one activity" ;
        sh:severity sh:Violation ;
        sh:message "⚠️ MISSING ACTIVITY: Entity has not generated any activities - create activity to process this entity" ;
    ] .

# Vortex Integrity Shape - ensures proper DIAS flow
tag:VortexIntegrityShape a sh:NodeShape ;
    sh:targetClass prov:Entity ;
    sh:property [
        sh:path prov:wasDerivedFrom ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Entity must be derived from source" ;
        sh:severity sh:Violation ;
        sh:message "⚠️ BROKEN VORTEX: Entity lacks source derivation - ensure proper intake flow" ;
    ] .

tag:AgentShape a sh:NodeShape ;
    sh:targetClass prov:Agent ;
    sh:property [
        sh:path prov:actedOnBehalfOf ;
        sh:nodeKind sh:IRI ;
        sh:class prov:Person ;
        sh:description "Agent must delegate to human if software" ;
    ] ;
    sh:property [
        sh:path rdfs:label ;
        sh:minCount 1 ;
        sh:datatype xsd:string ;
        sh:description "Agent must have label" ;
    ] .

tag:EntityShape a sh:NodeShape ;
    sh:targetClass prov:Entity ;
    sh:property [
        sh:path prov:wasGeneratedBy ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Entity must be generated by activity" ;
    ] ;
    sh:property [
        sh:path prov:generatedAtTime ;
        sh:maxCount 1 ;
        sh:datatype xsd:dateTime ;
        sh:description "Entity must have generation time" ;
    ] .

tag:ActivityShape a sh:NodeShape ;
    sh:targetClass prov:Activity ;
    sh:property [
        sh:path prov:used ;
        sh:minCount 1 ;
        sh:description "Activity must use at least one entity" ;
    ] ;
    sh:property [
        sh:path prov:startedAtTime ;
        sh:minCount 1 ;
        sh:datatype xsd:dateTime ;
        sh:description "Activity must have start time" ;
    ] ;
    sh:property [
        sh:path prov:endedAtTime ;
        sh:minCount 1 ;
        sh:datatype xsd:dateTime ;
        sh:description "Activity must have end time" ;
    ] ;
    sh:property [
        sh:path prov:qualifiedAssociation ;
        sh:minCount 1 ;
        sh:description "Activity must have qualified association" ;
    ] .

tag:AssociationShape a sh:NodeShape ;
    sh:targetClass prov:Association ;
    sh:property [
        sh:path prov:agent ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Association must have agent" ;
    ] ;
    sh:property [
        sh:path prov:hadPlan ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Association must have plan" ;
    ] ;
    sh:property [
        sh:path prov:hadRole ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Association must have role" ;
    ] .

tag:PlanShape a sh:NodeShape ;
    sh:targetClass prov:Plan ;
    sh:property [
        sh:path prov:wasDerivedFrom ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Plan must derive from goal" ;
    ] ;
    sh:property [
        sh:path rdfs:label ;
        sh:minCount 1 ;
        sh:datatype xsd:string ;
        sh:description "Plan must have label" ;
    ] .

tag:CollectionShape a sh:NodeShape ;
    sh:targetClass prov:Collection ;
    sh:property [
        sh:path prov:hadMember ;
        sh:minCount 1 ;
        sh:description "Collection must have at least one member" ;
    ] ;
    sh:property [
        sh:path prov:wasGeneratedBy ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Collection must be generated by activity" ;
    ] .

tag:StatementShape a sh:NodeShape ;
    sh:targetClass rdf:Statement ;
    sh:property [
        sh:path rdf:subject ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Statement must have subject" ;
    ] ;
    sh:property [
        sh:path rdf:predicate ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Statement must have predicate" ;
    ] ;
    sh:property [
        sh:path rdf:object ;
        sh:minCount 1 ;
        sh:description "Statement must have object" ;
    ] ;
    sh:property [
        sh:path prov:wasGeneratedBy ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Statement must be generated by activity" ;
    ] .
