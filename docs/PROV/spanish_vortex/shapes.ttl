@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix sh:   <http://www.w3.org/ns/shacl#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix tag:  <tag:mdld.js.org,2026:spanish:> .
@prefix ex:   <tag:mdld.js.org,2026:spanish:example:> .
@prefix mdp:  <http://mdld.js.org/prov/> .

# ========================================
# SHACL SHAPES FOR SPANISH VORTEX
# ========================================

# Phase 1 Intake Shape - ensures document processing (REQUIRED)
tag:Phase1IntakeShape a sh:NodeShape ;
    sh:target [
        a sh:Node ;
        sh:class prov:Entity ;
        sh:property [
            sh:path prov:atLocation ;
            sh:pattern "^https?://.*" ;
        ] ;
    ] ;
    sh:property [
        sh:path prov:wasUsedBy ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "External documents must be processed by internal activities" ;
        sh:severity sh:Violation ;
        sh:message " PHASE 1 INCOMPLETE: External document not processed - create internal analysis activity" ;
    ] .

# Phase 2 Processing Shape - ensures internal analysis (REQUIRED)
tag:Phase2ProcessingShape a sh:NodeShape ;
    sh:targetClass prov:Collection ;
    sh:property [
        sh:path prov:wasUsedBy ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Internal collections must be validated externally" ;
        sh:severity sh:Violation ;
        sh:message " PHASE 2 INCOMPLETE: Collection not externally validated - create external validation activity" ;
    ] .

# Phase 3 Validation Shape - ensures external verification (REQUIRED)
tag:Phase3ValidationShape a sh:NodeShape ;
    sh:target [
        a sh:Node ;
        sh:class prov:Entity ;
        sh:property [
            sh:path prov:hadPrimarySource ;
            sh:pattern "^https?://.*" ;
        ] ;
    ] ;
    sh:property [
        sh:path prov:wasUsedBy ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Externally sourced entities must be used by subsequent activities" ;
        sh:severity sh:Violation ;
        sh:message " PHASE 3 INCOMPLETE: External result not used by subsequent activity - create next phase activity" ;
    ] .

# Phase 4 Grounding Shape - ensures proper chain completion (FLEXIBLE)
tag:Phase4GroundingShape a sh:NodeShape ;
    sh:target [
        a sh:Node ;
        sh:equals ex:activity_grounding ;
    ] ;
    sh:property [
        sh:path prov:used ;
        sh:minCount 1 ;
        sh:node [
            sh:class prov:Entity ;
            sh:or [
                sh:property [
                    sh:path prov:hadPrimarySource ;
                    sh:pattern "^https?://.*" ;
                ] ;
                sh:property [
                    sh:path prov:hadPrimarySource ;
                    sh:pattern "^https?://.*" ;
                ] ;
            ] ;
        ] ;
        sh:description "Grounding activity must use externally sourced entities" ;
        sh:severity sh:Violation ;
        sh:message "⚠️ PHASE 4 INCOMPLETE: Grounding activity doesn't use external data - create proper grounding activity" ;
    ] .

# Goal Completion Shape - ensures goals are finalized (OPTIONAL)
tag:GoalCompletionShape a sh:NodeShape ;
    sh:targetClass prov:Plan ;
    sh:property [
        sh:path prov:wasInformedBy ;
        sh:minCount 0 ;
        sh:nodeKind sh:IRI ;
        sh:description "Goals may be informed by completion activities (optional for iterative development)" ;
        sh:severity sh:Info ;
        sh:message " GOAL STATUS: Goal completion status - optional for iterative vortex development" ;
    ] .

# Activity Chain Shape - ensures proper PROV-O influence flow (OPTIONAL)
tag:ActivityChainShape a sh:NodeShape ;
    sh:targetClass prov:Activity ;
    sh:property [
        sh:path prov:wasInfluencedBy ;
        sh:minCount 0 ;
        sh:nodeKind sh:IRI ;
        sh:description "Activities may be influenced by preceding activities (optional for flexible development)" ;
        sh:severity sh:Info ;
        sh:message " ACTIVITY CHAIN: Activity influence status - optional for iterative vortex development" ;
    ] .

# Grounding Validation Shape - ensures entities have external sources (OPTIONAL)
tag:GroundingValidationShape a sh:NodeShape ;
    sh:targetClass prov:Entity ;
    sh:property [
        sh:path prov:hadPrimarySource ;
        sh:minCount 0 ;
        sh:nodeKind sh:IRI ;
        sh:description "Entities may have external verification sources (optional for flexible development)" ;
        sh:severity sh:Info ;
        sh:message " GROUNDING STATUS: Entity grounding status - optional for iterative vortex development" ;
    ] .

tag:AgentShape a sh:NodeShape ;
    sh:targetClass prov:Agent ;
    sh:property [
        sh:path prov:actedOnBehalfOf ;
        sh:nodeKind sh:IRI ;
        sh:class prov:Person ;
        sh:description "Agent must delegate to human if software" ;
    ] ;
    sh:property [
        sh:path rdfs:label ;
        sh:minCount 1 ;
        sh:datatype xsd:string ;
        sh:description "Agent must have label" ;
    ] .

tag:EntityShape a sh:NodeShape ;
    sh:targetClass prov:Entity ;
    sh:property [
        sh:path prov:wasGeneratedBy ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Entity must be generated by activity" ;
    ] ;
    sh:property [
        sh:path prov:generatedAtTime ;
        sh:maxCount 1 ;
        sh:datatype xsd:dateTime ;
        sh:description "Entity must have generation time" ;
    ] .

tag:ActivityShape a sh:NodeShape ;
    sh:targetClass prov:Activity ;
    sh:property [
        sh:path prov:used ;
        sh:minCount 1 ;
        sh:description "Activity must use at least one entity" ;
    ] ;
    sh:property [
        sh:path prov:startedAtTime ;
        sh:minCount 1 ;
        sh:datatype xsd:dateTime ;
        sh:description "Activity must have start time" ;
    ] ;
    sh:property [
        sh:path prov:endedAtTime ;
        sh:minCount 1 ;
        sh:datatype xsd:dateTime ;
        sh:description "Activity must have end time" ;
    ] ;
    sh:property [
        sh:path prov:qualifiedAssociation ;
        sh:minCount 1 ;
        sh:description "Activity must have qualified association" ;
    ] .

tag:AssociationShape a sh:NodeShape ;
    sh:targetClass prov:Association ;
    sh:property [
        sh:path prov:agent ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Association must have agent" ;
    ] ;
    sh:property [
        sh:path prov:hadPlan ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Association must have plan" ;
    ] ;
    sh:property [
        sh:path prov:hadRole ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Association must have role" ;
    ] .

tag:PlanShape a sh:NodeShape ;
    sh:targetClass prov:Plan ;
    sh:property [
        sh:path prov:wasDerivedFrom ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Plan must derive from goal" ;
    ] ;
    sh:property [
        sh:path rdfs:label ;
        sh:minCount 1 ;
        sh:datatype xsd:string ;
        sh:description "Plan must have label" ;
    ] .

tag:CollectionShape a sh:NodeShape ;
    sh:targetClass prov:Collection ;
    sh:property [
        sh:path prov:hadMember ;
        sh:minCount 1 ;
        sh:description "Collection must have at least one member" ;
    ] ;
    sh:property [
        sh:path prov:wasGeneratedBy ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Collection must be generated by activity" ;
    ] .

tag:StatementShape a sh:NodeShape ;
    sh:targetClass rdf:Statement ;
    sh:property [
        sh:path rdf:subject ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Statement must have subject" ;
    ] ;
    sh:property [
        sh:path rdf:predicate ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Statement must have predicate" ;
    ] ;
    sh:property [
        sh:path rdf:object ;
        sh:minCount 1 ;
        sh:description "Statement must have object" ;
    ] ;
    sh:property [
        sh:path prov:wasGeneratedBy ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:description "Statement must be generated by activity" ;
    ] .
