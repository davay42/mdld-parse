<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MD-LD - Markdown Linked Data Parser</title>
    <meta name="description"
        content="MD-LD: Human-friendly RDF authoring format. Write semantic data in natural Markdown. Parse to RDF triples. Zero dependencies.">
    <style>
        :root {
            --bg-light: #f8f9fa;
            --text-dark: #374151;
            --accent-orange: #af540f;
            --accent-orange-light: #d9711f;
            --border-dark: #374151;
            --bg-code: #e2e2e2;
            --text-code: #1d1d1d;
            --text-muted: #525253;
            --bg-feature: rgb(255, 254, 248);
            --text-feature: #181818;
            --bg-hover: rgb(227, 222, 218);
            --border-focus: #60a5fa;
            --bg-button-primary: #6a9962;
            --bg-button-primary-hover: #2563eb;
            --bg-button-secondary: #4b5563;
            --bg-button-secondary-hover: #6b7280;
            --bg-button-danger: #ef4444;
            --bg-button-danger-hover: #dc2626;
            --bg-input: #d2d2d2;
            --border-chip-default: #334155;
            --bg-chip-default: #7e7e7f;
            --text-chip-key: #94a3b8;
            --border-chip-subject: #1e3a8a;
            --bg-chip-subject: #dbd9d9;
            --text-chip-subject: #0c4587;
            --border-chip-predicate: #334155;
            --bg-chip-predicate: #cfd1d5;
            --text-chip-predicate: #313335;
            --border-chip-object: #3f3f46;
            --bg-chip-object: #b8cfc0;
            --text-chip-object: #0d361e;
            --border-chip-literal: #44403c;
            --bg-chip-literal: #b4c1b3;
            --text-chip-literal: #bfc6be;
            --text-separator: #64748b;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-info: #60a5fa;
            --text-pill: #cbd5e1;
            --bg-table-header: #111827;
            --text-table-header: #cbd5e1;
            --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', monospace;
            line-height: 1.5;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        code {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace
        }

        .container {
            max-width: 65ch;
            margin: 0 auto;
            padding: 1rem
        }

        .hidden {
            display: none
        }

        .link-hover:hover {
            background: var(--bg-hover);
            border-color: var(--accent-orange);
        }

        .example-hover:hover {
            border-color: var(--border-focus);
        }

        .btn-hover:hover {
            transform: translateY(-1px);
        }

        @media (max-width: 900px) {
            .playground {
                grid-template-columns: 1fr !important
            }
        }

        @media (max-width: 768px) {
            .stats {
                grid-template-columns: repeat(2, 1fr) !important
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.min.css">
</head>

<body>
    <div class="container">
        <header
            style="text-align: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-dark);">
            <div style="font-size: 4em;">
                <span style="opacity:50%">{</span><span style="color: var(--accent-orange)">=+ .?!</span><span
                    style="opacity:50%">}</span>
            </div>
            <h1
                style="font-size: 3.5rem; font-weight: 700; margin-bottom: .5rem; background: linear-gradient(135deg, var(--accent-orange-light), var(--accent-orange)); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                MD-LD</h1>
            <h2 style="font-size: 1.5rem; font-weight: 500; margin-bottom: .5rem; color: var(--text-dark);">Markdown
                Linked Data</h2>
            <p style="font-size: 1.2rem; color: var(--accent-orange); margin-bottom: 1rem;">Human-friendly knowledge
                graph authoring</p>
            <div style="display: flex; gap: .5rem; justify-content: center; flex-wrap: wrap; margin-bottom: 1rem;">
                <a href="https://github.com/davay42/mdld-parse" target="_blank" class="link-hover"
                    style="color: var(--accent-orange); text-decoration: none; padding: .25rem .75rem; border: 1px solid var(--border-dark); border-radius: 4px; font-size: .875rem; transition: all .2s;">üì¶
                    GitHub</a>
                <a href="https://www.npmjs.com/package/mdld-parse" target="_blank" class="link-hover"
                    style="color: var(--accent-orange); text-decoration: none; padding: .25rem .75rem; border: 1px solid var(--border-dark); border-radius: 4px; font-size: .875rem; transition: all .2s;">üì¶
                    npm</a>
            </div>
        </header>

        <section id="format"
            style="background: var(--bg-code); border-radius: 6px; padding: 1rem; margin-bottom: 1rem;">
            <h3 style="margin-bottom: .5rem; color: var(--text-feature); font-size: 1rem;">üìñ What is MD-LD?</h3>
            <p style="color: var(--text-muted); font-size: .875rem; margin-bottom: .5rem;">MD-LD extends Markdown with
                semantic annotations using <code>{...}</code> blocks. Write natural language
                documents while embedding structured RDF data.</p>

            <div style="display: flex; flex-wrap: wrap; gap: .5rem;">
                <div style="background: var(--bg-feature); border-radius: 0.5em; padding: .5rem; flex: 1">
                    <h4 style="margin-bottom: .25rem; color: var(--text-feature); font-size: .875rem;">üìù Natural Syntax
                    </h4>
                    <p style="color: var(--text-muted); font-size: .75rem;">Write semantic data in familiar Markdown</p>
                </div>
                <div style="background: var(--bg-feature); border-radius: 0.5em; padding: .5rem; flex: 1">
                    <h4 style="margin-bottom: .25rem; color: var(--text-feature); font-size: .875rem;">üîó RDF Output
                    </h4>
                    <p style="color: var(--text-muted); font-size: .75rem;">Parse to standard RDF triples</p>
                </div>
                <div style="background: var(--bg-feature);  border-radius: .5em; padding: .5rem; flex: 1;">
                    <h4 style="margin-bottom: .25rem; color: var(--text-feature); font-size: .875rem;">‚ö° Zero
                        Dependencies</h4>
                    <p style="color: var(--text-muted); font-size: .75rem;">Lightweight parser</p>
                </div>
                <div style="background: var(--bg-feature); border-radius: .5em; padding: .5rem; flex: 1;">
                    <h4 style="margin-bottom: .25rem; color: var(--text-feature); font-size: .875rem;">üîÑ Bidirectional
                    </h4>
                    <p style="color: var(--text-muted); font-size: .75rem;">Parse & serialize round-trip</p>
                </div>
            </div>
        </section>

        <section id="playground"
            style="background: var(--bg-code); border-radius: 6px; padding: 1rem; margin-bottom: 1rem;">
            <h3 style="margin-bottom: .5rem; color: var(--text-feature); font-size: 1rem;">üéÆ Interactive Playground
            </h3>

            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: .5rem; margin-bottom: 1rem;">
                <div onclick="loadExample('minimal')" class="example-hover"
                    style="background: var(--bg-code); border: 1px solid var(--border-dark); border-radius: 4px; padding: .75rem; cursor: pointer; transition: all .2s;">
                    <h4 style="margin-bottom: .25rem; color: var(--text-feature); font-size: .875rem;">üçå Minimal viable
                    </h4>
                    <p style="font-size: .75rem; color: var(--text-muted);">Smallest example of knowledge authoring</p>
                </div>
                <div onclick="loadExample('journal')" class="example-hover"
                    style="background: var(--bg-code); border: 1px solid var(--border-dark); border-radius: 4px; padding: .75rem; cursor: pointer; transition: all .2s;">
                    <h4 style="margin-bottom: .25rem; color: var(--text-feature); font-size: .875rem;">üìî Personal
                        Journal</h4>
                    <p style="font-size: .75rem; color: var(--text-muted);">Mood, location, people</p>
                </div>
                <div onclick="loadExample('recipe')" class="example-hover"
                    style="background: var(--bg-code); border: 1px solid var(--border-dark); border-radius: 4px; padding: .75rem; cursor: pointer; transition: all .2s;">
                    <h4 style="margin-bottom: .25rem; color: var(--text-feature); font-size: .875rem;">üç≥ Recipe</h4>
                    <p style="font-size: .75rem; color: var(--text-muted);">Ingredients & instructions</p>
                </div>
                <div onclick="loadExample('project')" class="example-hover"
                    style="background: var(--bg-code); border: 1px solid var(--border-dark); border-radius: 4px; padding: .75rem; cursor: pointer; transition: all .2s;">
                    <h4 style="margin-bottom: .25rem; color: var(--text-feature); font-size: .875rem;">üìã Project</h4>
                    <p style="font-size: .75rem; color: var(--text-muted);">Tasks & relationships</p>
                </div>
                <div onclick="loadExample('apollo')" class="example-hover"
                    style="background: var(--bg-code); border: 1px solid var(--border-dark); border-radius: 4px; padding: .75rem; cursor: pointer; transition: all .2s;">
                    <h4 style="margin-bottom: .25rem; color: var(--text-feature); font-size: .875rem;">üöÄ Apollo Mission
                    </h4>
                    <p style="font-size: .75rem; color: var(--text-muted);">Prefix folding & nested lists</p>
                </div>
                <div onclick="loadExample('research')" class="example-hover"
                    style="background: var(--bg-code); border: 1px solid var(--border-dark); border-radius: 4px; padding: .75rem; cursor: pointer; transition: all .2s;">
                    <h4 style="margin-bottom: .25rem; color: var(--text-feature); font-size: .875rem;">üî¨ Research Paper
                    </h4>
                    <p style="font-size: .75rem; color: var(--text-muted);">Angle-bracket URLs & datasets</p>
                </div>
            </div>
            <div
                style="display: flex; flex-flow: wrap; grid-template-columns: minmax(360px, 1.2fr) minmax(360px, 1fr) minmax(360px, 1fr); gap: 1rem; margin-bottom: 1rem; align-items: start;">
                <div style="min-width: 100%;">
                    <h3 style="margin-bottom: .5rem; color: var(--text-feature); font-size: 1rem;">MD-LD Input</h3>
                    <textarea id="input" class="language-markdown"
                        style="width: 100%; height: 250px; padding: .75rem; border: 1px solid var(--border-dark); border-radius: 4px; font-family: var(--font-mono); font-size: 13px; resize: vertical; background: var(--bg-light); color: var(--text-code);"
                        placeholder="Write your MD-LD here...

Examples showcase real-world scenarios:
- Recipe: Simple lists with ingredients & equipment
- Project: Tasks, resources, and team members
- Apollo: Prefix folding for NASA mission hierarchy
- Research: Angle-bracket URLs for papers & datasets

## Document {=ex:doc}
Title: [My Document] {name}
Author: [Alice] {+ex:alice .Person ?author name}"></textarea>
                </div>

                <div style="min-width: 0;">
                    <h3 style="margin-bottom: .5rem; color: var(--text-feature); font-size: 1rem;">Quads
                    </h3>
                    <div id="output"
                        style="background: var(--bg-light); border: 1px solid var(--border-dark); border-radius: 4px; padding: .75rem; height: 250px; font-family: var(--font-mono); font-size: 13px; white-space: pre-wrap; overflow: auto; color: var(--text-code);">
                        Quads will appear here...</div>
                </div>

                <pre style="width:100%; max-height:280px;overflow-y: scroll;">
                    <code id="ttl" class="language-turtle" style="font-size:0.8em;display:block">
                        TTL loading...</code>
                    </pre>

                <div style="min-width: 0;" id="rendered-section" style="display: none;">
                    <h3 style="margin-bottom: .5rem; color: var(--text-feature); font-size: 1rem;">Rendered HTML+RDFa
                    </h3>
                    <div id="rendered-output"
                        style="background: var(--bg-code); border: 1px solid var(--border-dark); border-radius: 4px; padding: .75rem; height: 250px; font-family: var(--font-mono); font-size: 13px; overflow: auto; color: var(--text-code);">
                        Rendered HTML will appear here...</div>
                </div>
            </div>
            <div class="container" style="display: flex; gap: .5rem; margin-bottom: 1rem; align-items: center;">
                <button onclick="parseMDLD()" class="btn-hover"
                    style="background: var(--bg-button-primary); color: #fff; border: none; padding: .5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: .875rem;">üîÑ
                    Parse
                    MD-LD</button>
                <button onclick="clearPlayground()" class="btn-hover"
                    style="background: var(--bg-button-secondary); color: #fff; border: none; padding: .5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: .875rem;">üóëÔ∏è
                    Clear</button>
                <button onclick="toggleQuadLab()" class="btn-hover"
                    style="background: var(--bg-button-secondary); color: #fff; border: none; padding: .5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: .875rem;">üß©
                    Quad
                    Lab</button>
                <span id="parse-stats"
                    style="display: flex; gap: 1rem; font-size: .875rem; color: var(--text-muted); margin-left: auto;"></span>
            </div>

            <div style="margin-top: .75rem;" class="hidden container" id="quadlab">
                <h3 style="margin-bottom: .5rem; color: var(--text-feature); font-size: 1rem;">üß© Quad Lab (CRUD + diff
                    apply)</h3>
                <p style="color: var(--text-muted); margin-bottom: .5rem;">Edit quads below. Applying changes generates
                    a diff and calls <code>applyDiff()</code>
                    to patch the MD-LD source.</p>
                <div style="display: flex; gap: .5rem; margin-bottom: .5rem; align-items: center;">
                    <button onclick="quadLabReset()" class="btn-hover"
                        style="background: var(--bg-button-secondary); color: #fff; border: none; padding: .5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: .875rem;">‚Ü©
                        Reset
                        from parse()</button>
                    <button onclick="quadLabAddRow()" class="btn-hover"
                        style="background: var(--bg-button-primary); color: #fff; border: none; padding: .5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: .875rem;">‚ûï
                        Add quad</button>
                    <button onclick="quadLabDeleteSelected()" class="btn-hover"
                        style="background: var(--bg-button-danger); color: #fff; border: none; padding: .5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: .875rem;">üóë
                        Delete selected</button>
                    <span id="quadlab-stats"
                        style="display: flex; gap: 1rem; font-size: .875rem; color: var(--text-muted); margin-left: auto;"></span>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <table
                            style="width: 100%; border-collapse: collapse; border: 1px solid var(--border-dark); border-radius: 4px; overflow: hidden;">
                            <thead>
                                <tr>
                                    <th
                                        style="width: 2.5rem; background: var(--bg-table-header); color: var(--text-table-header); font-weight: 600; border-bottom: 1px solid var(--border-dark); padding: .35rem .5rem; text-align: left; font-size: .8rem;">
                                        Sel</th>
                                    <th
                                        style="background: var(--bg-table-header); color: var(--text-table-header); font-weight: 600; border-bottom: 1px solid var(--border-dark); padding: .35rem .5rem; text-align: left; font-size: .8rem;">
                                        S</th>
                                    <th
                                        style="background: var(--bg-table-header); color: var(--text-table-header); font-weight: 600; border-bottom: 1px solid var(--border-dark); padding: .35rem .5rem; text-align: left; font-size: .8rem;">
                                        P</th>
                                    <th
                                        style="background: var(--bg-table-header); color: var(--text-table-header); font-weight: 600; border-bottom: 1px solid var(--border-dark); padding: .35rem .5rem; text-align: left; font-size: .8rem;">
                                        O</th>
                                </tr>
                            </thead>
                            <tbody id="quadlab-body"></tbody>
                        </table>
                    </div>
                    <div>
                        <div id="quadlab-diff"
                            style="background: var(--bg-code); border: 1px solid var(--border-dark); border-radius: 4px; padding: .75rem; height: 250px; font-family: var(--font-mono); font-size: 13px; white-space: pre-wrap; overflow: auto; color: var(--text-code);">
                            Diff will appear here...</div>
                        <div style="display: flex; gap: .5rem; margin-top: .5rem; margin-bottom: 0;">
                            <button onclick="quadLabApplyDiff()" class="btn-hover btn-hover-primary"
                                style="background: var(--bg-button-primary); color: #fff; border: none; padding: .5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: .875rem;">‚úÖ
                                Apply diff via
                                applyDiff()</button>
                            <button onclick="quadLabCopyDiff()" class="btn-hover btn-hover-secondary"
                                style="background: var(--bg-button-secondary); color: #fff; border: none; padding: .5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: .875rem;">üìã
                                Copy diff
                                JSON</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="container" id="tests"
            style="background: var(--bg-code); border-radius: 6px; padding: 1rem; margin-bottom: 1rem;">
            <h3 style="margin-bottom: .5rem; color: var(--text-feature); font-size: 1rem;">üß™ Test Suite</h3>
            <div style="display: flex; gap: .5rem; margin-bottom: .5rem; align-items: center;">
                <button onclick="runAllTests()" class="btn-hover btn-hover-primary"
                    style="background: var(--bg-button-primary); color: #fff; border: none; padding: .5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: .875rem; transition: all .2s;">‚ñ∂
                    Run Tests</button>
                <button onclick="clearTests()" class="btn-hover btn-hover-secondary"
                    style="background: var(--bg-button-secondary); color: #fff; border: none; padding: .5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: .875rem; transition: all .2s;">üóëÔ∏è
                    Clear</button>
                <span id="test-status"
                    style="display: flex; gap: 1rem; font-size: .875rem; color: var(--text-muted); margin-left: auto;"></span>
            </div>
            <div id="test-progress"
                style="height: 3px; background: var(--border-dark); border-radius: 2px; overflow: hidden; margin-bottom: .5rem; display: none;">
                <div id="test-progress-bar"
                    style="height: 100%; background: var(--bg-button-primary); transition: width .3s ease;"></div>
            </div>
            <div id="test-stats"
                style="display: grid; grid-template-columns: repeat(4, 1fr); gap: .5rem; margin-bottom: .5rem; display: none;">
                <div
                    style="background: var(--bg-feature); padding: .5rem; border-radius: 4px; text-align: center; border: 1px solid var(--border-dark);">
                    <div id="passed-count"
                        style="font-size: 1.25rem; font-weight: 700; margin-bottom: .25rem; color: var(--color-success);">
                        0</div>
                    <div style="font-size: .75rem; color: var(--text-muted);">Passed</div>
                </div>
                <div
                    style="background: var(--bg-feature); padding: .5rem; border-radius: 4px; text-align: center; border: 1px solid var(--border-dark);">
                    <div id="failed-count"
                        style="font-size: 1.25rem; font-weight: 700; margin-bottom: .25rem; color: var(--color-error);">
                        0</div>
                    <div style="font-size: .75rem; color: var(--text-muted);">Failed</div>
                </div>
                <div
                    style="background: var(--bg-feature); padding: .5rem; border-radius: 4px; text-align: center; border: 1px solid var(--border-dark);">
                    <div id="total-count"
                        style="font-size: 1.25rem; font-weight: 700; margin-bottom: .25rem; color: var(--color-info);">0
                    </div>
                    <div style="font-size: .75rem; color: var(--text-muted);">Total</div>
                </div>
                <div
                    style="background: var(--bg-feature); padding: .5rem; border-radius: 4px; text-align: center; border: 1px solid var(--border-dark);">
                    <div id="duration" style="font-size: 1.25rem; font-weight: 700; margin-bottom: .25rem;">0ms</div>
                    <div style="font-size: .75rem; color: var(--text-muted);">Duration</div>
                </div>
            </div>
            <div id="test-list" style="max-height: 300px; overflow-y: auto;">
                <p style="text-align: center; color: var(--text-muted); padding: 1rem;">Tests will run automatically on
                    page
                    load...</p>
            </div>
        </section>

        <section class="container" id="spec"
            style="background: var(--bg-code); border-radius: 6px; padding: 1rem; margin-bottom: 1rem;">
            <h3 style="margin-bottom: .5rem; color: var(--text-feature); font-size: 1rem;"><a href="/docs/Spec/Spec.md"
                    style="text-decoration: none;">üìã MD-LD Specification </a></h3>
            <div style="display: flex; gap: .5rem; margin-bottom: .5rem; align-items: center;">
                <span id="spec-status"
                    style="display: flex; gap: 1rem; font-size: .875rem; color: var(--text-muted); margin-left: auto;"></span>
            </div>
            <div id="spec-content"
                style="max-height: 80svh; overflow-y: scroll; background: var(--bg-light); border: 1px solid var(--border-dark); border-radius: 4px; padding: 1rem; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; color: var(--text-dark);">
                <p style="text-align: center; color: var(--text-muted); padding: 2rem; ">
                    Loading specification...</p>
            </div>
        </section>
    </div>

    <script type="importmap">
  {
    "imports": {
      "./index.js": "./index.js",
      "./tests.js": "./tests.js",
      "n3": "https://esm.sh/n3@2.0.1",
      "markdown-it": "https://esm.sh/markdown-it@14.1.0"
    }
  }
  </script>

    <script type="module">
        import { parse, applyDiff, shortenIRI } from './src/index.js';
        import { render } from './src/render.js';
        import { runTests, tests } from './tests/index.js';
        import { Writer, DataFactory as N3DataFactory, Store } from 'n3';
        import MarkdownIt from 'markdown-it';

        let currentTestResults = [];

        // Development flag to enable/disable RDFa rendering
        // Set to false for production, true for development
        const ENABLE_RDFA_RENDER = false;

        // Show/hide rendered HTML section based on flag
        document.addEventListener('DOMContentLoaded', function () {
            const renderedSection = document.getElementById('rendered-section');
            if (renderedSection) {
                renderedSection.style.display = ENABLE_RDFA_RENDER ? 'block' : 'none';
            }
        });

        // Example templates
        const examples = {
            minimal: `[ex] <http://example.com/>
            
## Document {=ex:doc .ex:Document label}
Author: [Alice] {+ex:alice .ex:Person ?ex:author ex:name}
`,
            journal: `[my] <tag:alice@example.com,2026:>

## 2024-07-18 ‚Äî A good day {=my:journal-2024-07-18 .my:Event}

Mood: [Happy] {my:mood}
Energy level: [8] {my:energyLevel ^^xsd:integer}
Place: [Central Park] {+my:central-park ?my:location .my:Place label @en}
With: [Sam] {+my:sam .my:Person ?my:attendee}
Weather: [Sunny] {my:weather}

Activities: {?my:hasActivity .my:Activity label}

- Walking {=#walking}
- Reading {=#reading}

Reflections:
I felt [peaceful] {my:emotionalState} and the park was [beautiful] {my:description}.

Related events: {!my:relatedEvent  .my:Event}
- Morning coffee {=my:coffee-2024-07-18}
- Evening dinner {=my:dinner-2024-07-18}`,

            recipe: `[food] <tag:alice@example.com,2026:food/>

## Apple Pie {=food:apple-pie .food:Recipe label}

Description: **Classic homemade apple pie** {comment}
Cooking time: **45** {food:cookTime ^^xsd:integer} minutes
Servings: **8** {food:recipeYield ^^xsd:integer}
Difficulty: **Medium** {food:difficulty}

Ingredients: {?food:recipeIngredient .food:ingredient label}

- Flour {=food:flour}
  Variants: {?food:hasVariant .food:FlourType label}
  - Whole wheat {=food:flour-whole}
  - All-purpose {=food:flour-white}
- Sugar {=food:sugar}
  Types: {?food:hasType .food:Sweetener label}
  - White sugar {=food:sugar-white}
  - Brown sugar {=food:sugar-brown}
- Butter {=food:butter}
- Apples {=food:apples}
  Varieties: {?food:hasVariety .food:AppleType label}
  - Granny Smith {=food:apples-granny .food:TartApple}
  - Honeycrisp {=food:apples-honey .food:SweetApple}
- Cinnamon {=food:cinnamon}

Equipment: {?food:requiresEquipment .food:Equipment label}

- Oven {=food:oven .food:Device}
  Features: {?food:hasFeature .food:Feature label}
  - Convection {=food:oven-convection .food:ConvectionFeature}
  - Temperature control {=food:oven-temp .food:TempControl}
- Mixing bowl {=food:bowl .food:Utensil}
- Rolling pin {=food:pin .food:Utensil}

Calories:  [1235] {food:calories ^^xsd:integer} calories
Sugar: [40.4] {food:sugarGrams ^^xsd:decimal} grams

Related recipes: {!food:variationOf .food:Recipe name}

- Apple Crumble {=food:apple-crumble}
- Peach Pie {=food:peach-pie}`,

            project: `[proj] <tag:alice@example.com,2026:project/>

## Weekend goals {=proj:weekend-goals .proj:Project}

Tasks: {?proj:hasTask .proj:Task label}

- Clean kitchen {=proj:task-clean}
  Subtasks: {?proj:hasSubtask .proj:Subtask label}
  - Clear countertops {=proj:task-clean-counters}
  - Wash dishes {=proj:task-clean-dishes}
  - Organize pantry {=proj:task-clean-pantry}
- Fix bike {=proj:task-bike}
  Steps: {?proj:hasStep .proj:Step label}
  - Check tire pressure {=proj:step-tire-pressure}
  - Adjust brakes {=proj:step-brakes}
  - Lubricate chain {=proj:step-chain}
- Read book {=proj:task-read}
  Reading plan: {?proj:hasReadingPlan .proj:ReadingPlan label}
  - Chapter 1-2 {=proj:read-ch1-2}
  - Chapter 3-4 {=proj:read-ch3-4}
  - Chapter 5-6 {=proj:read-ch5-6}

Resources: {?proj:requiresResource .proj:Resource label}

- Hardware store {=proj:hardware-store}
  Items needed: {?proj:needsItem .proj:Item label}
  - Screws {=proj:item-screws}
  - Bike pump {=proj:item-pump}
- GitHub repository {=proj:github-repo .proj:Repository}
  Repository details: {?proj:hasRepositoryDetail .proj:RepositoryDetail label}
  - Source code {=proj:repo-source}
  - Documentation {=proj:repo-docs}

Team: {?proj:hasTeamMember .proj:Person role}

- Myself {=proj:myself ?proj:projectManager}
  Skills: {?proj:hasSkill .proj:Skill label}
  - Planning {=proj:skill-planning}
  - Cooking {=proj:skill-cooking}
- Bob {=proj:bob .proj:Person ?proj:helper}
  Skills: {?proj:hasSkill .proj:Skill label}
  - Bike repair {=proj:skill-bike}
  - Organizing {=proj:skill-organizing}

Blocked by: {!proj:blocks .proj:Blocker label}

- Rain forecast {=proj:weather-forecast}
  Alternatives: {?proj:hasAlternative .proj:Alternative label}
  - Indoor cleaning {=proj:alt-indoor}
  - Online shopping {=proj:alt-shopping}`,

            apollo: `[nasa] <http://nasa.gov/>
[mission] <nasa:mission:>
[crew] <nasa:crew:>
[equip] <nasa:equipment:>

# Apollo 11 {=mission:apollo-11 .nasa:SpaceMission label}

Launch year: [1969] {nasa:startDate ^^xsd:gYear}
Landing date: [1969-07-20] {nasa:endDate ^^xsd:date}
Duration: [8] {nasa:durationDays ^^xsd:integer}
Budget: [2.5] {nasa:billionUSD ^^xsd:decimal}

Crew: {?nasa:hasCrew .nasa:Person nasa:name}

- Neil Armstrong {=crew:armstrong}
- Buzz Aldrin {=crew:aldrin}
- Michael Collins {=crew:collins}

Equipment: {?nasa:hasEquipment .nasa:Equipment label}

- Saturn V {=equip:saturn-v .nasa:Rocket}
- Lunar Module {=equip:lm-eagle .nasa:Module}
- Command Module {=equip:cm-columbia .nasa:Module}

Mission objectives: {?nasa:objective .nasa:Goal label}

- Land on Moon {=nasa:goal-land}
- Return safely {=nasa:goal-return}
- Collect samples {=nasa:goal-sample}

Related missions: {!nasa:precededBy .nasa:SpaceMission label}

- Apollo 10 {=mission:apollo-10}
- Gemini 8 {=mission:gemin-8}`,

            research: `[research] <https://research.example.org/>
[pub] <https://research.example.org/publications/>
[data] <https://research.example.org/datasets/>

# Scientific Paper Analysis {=research:paper-2024 .research:Paper}

## Abstract
This paper analyzes <https://arxiv.org/abs/2301.07041> {?research:cites .research:Paper} 
and references <https://doi.org/10.1000/xyz123> {?research:hasVersion .research:Article}.

## Methodology

### ML Dataset {=data:ml-dataset .research:Dataset}

Source: <https://github.com/user/repo> {?research:sourceUrl}

Dataset details: {?research:hasDatasetDetail .research:DatasetDetail label}

- Training set {=data:ml-training .research:TrainingSet}
- Test set {=data:ml-test .research:TestSet}
- Validation set {=data:ml-validation .research:ValidationSet}

### Kaggle Dataset {=data:kaggle-dataset .research:Dataset}

Source: <https://kaggle.com/dataset123> {?research:sourceUrl}

Features: {?research:hasFeature .research:Feature label}

- Image data {=data:kaggle-images .research:ImageFeature}
- Metadata {=data:kaggle-metadata .research:MetadataFeature}

### NASA Organization {=research:nasa .research:Organization}

Departments: {?research:hasDepartment .research:Department label}

- Research division {=research:nasa-research .research:ResearchDivision}
- Data science lab {=research:nasa-ds .research:DataScienceLab}

### MIT Organization {=research:mit .research:Organization}

Labs: {?research:hasLab .research:Lab label}

- AI lab {=research:mit-ai .research:AILab}
- Statistics lab {=research:mit-stats .research:StatsLab}

## Results

Statistical significance: [p < 0.05] {research:significance}
Sample size: [1000] {research:sampleSize ^^xsd:integer}
Confidence interval: [95%] {research:confidenceInterval}

## Related Work

Paper 1: <https://example.com/paper1> {!research:precedes .research:Paper}
Paper 2: <https://example.com/paper2> {!research:precedes .research:Paper}

## Future Research

Future directions: {?research:suggestsFutureResearch .research:FutureResearch label}

- Extended analysis {=research:future-extended}
- Larger dataset {=research:future-larger-dataset}
- Cross-validation {=research:future-crossval}`
        };

        // Load example
        window.loadExample = function (name) {
            document.getElementById('input').value = examples[name];
            parseMDLD();
        };

        let lastParse = null;

        function escapeHtml(s) {
            return String(s)
                .replaceAll('&', '&amp;')
                .replaceAll('<', '&lt;')
                .replaceAll('>', '&gt;')
                .replaceAll('"', '&quot;')
                .replaceAll("'", '&#39;');
        }

        function short(term, ctx) {
            return shortenIRI(term, ctx);
        }

        function clipTitle(full, display) {
            return display === full ? display : `${display}\n${full}`;
        }

        function chip(kind, fullValue, displayValue, extraClass = '') {
            const d = escapeHtml(displayValue);
            const t = escapeHtml(clipTitle(fullValue, displayValue));

            let borderColor = 'var(--border-chip-default)';
            let bgColor = 'var(--bg-chip-default)';
            let keyColor = 'var(--text-chip-key)';

            if (extraClass === 'q-s') {
                borderColor = 'var(--border-chip-subject)';
                bgColor = 'var(--bg-chip-subject)';
                keyColor = 'var(--text-chip-subject)';
            } else if (extraClass === 'q-p') {
                borderColor = 'var(--border-chip-predicate)';
                bgColor = 'var(--bg-chip-predicate)';
                keyColor = 'var(--text-chip-predicate)';
            } else if (extraClass === 'q-o') {
                borderColor = 'var(--border-chip-object)';
                bgColor = 'var(--bg-chip-object)';
                keyColor = 'var(--text-chip-object)';
            } else if (extraClass === 'q-lit') {
                borderColor = 'var(--border-chip-literal)';
                bgColor = 'var(--bg-chip-literal)';
                keyColor = 'var(--text-chip-literal)';
            }

            return `<span style="display: inline-flex; align-items: center; gap: .35rem; max-width: 100%; border: 1px solid ${borderColor}; background: ${bgColor}; border-radius: 6px; padding: .12rem .4rem;">
                <span style="display: inline-block; max-width: 48ch; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${t}">${d}</span></span>`;
        }


        function quadKey(quad) {
            const o = quad.object;
            const oKey = o.termType === 'Literal'
                ? JSON.stringify({ t: 'L', v: o.value, lang: o.language || '', dt: o.datatype?.value || '' })
                : JSON.stringify({ t: o.termType, v: o.value });
            return JSON.stringify([quad.subject.value, quad.predicate.value, oKey]);
        }

        function parseObjectField(raw) {
            const s = String(raw || '').trim();
            if (!s) return null;
            if (s.startsWith('"')) {
                const m = s.match(/^"([\s\S]*)"(?:@([a-zA-Z-]+)|\^\^<([^>]+)>|\^\^([^\s]+))?$/);
                if (!m) return { termType: 'Literal', value: s.replace(/^"|"$/g, ''), language: '', datatype: { termType: 'NamedNode', value: 'http://www.w3.org/2001/XMLSchema#string' } };
                const value = m[1].replace(/\\"/g, '"');
                if (m[2]) return { termType: 'Literal', value, language: m[2], datatype: { termType: 'NamedNode', value: 'http://www.w3.org/1999/02/22-rdf-syntax-ns#langString' } };
                const dt = m[3] || m[4];
                if (dt) return { termType: 'Literal', value, language: '', datatype: { termType: 'NamedNode', value: dt.startsWith('http') ? dt : dt } };
                return { termType: 'Literal', value, language: '', datatype: { termType: 'NamedNode', value: 'http://www.w3.org/2001/XMLSchema#string' } };
            }
            const iri = s.startsWith('<') && s.endsWith('>') ? s.slice(1, -1) : s;
            return { termType: 'NamedNode', value: iri };
        }

        // Parse MD-LD
        window.parseMDLD = function () {
            const input = document.getElementById('input').value;
            const output = document.getElementById('output');
            const rendered = document.getElementById('rendered-output');
            const stats = document.getElementById('parse-stats');



            if (!input.trim()) {
                output.textContent = 'Quads will appear here...';
                if (ENABLE_RDFA_RENDER) {
                    rendered.textContent = 'Rendered HTML will appear here...';
                }
                stats.textContent = '';
                return;
            }

            try {
                const startTime = performance.now();
                const result = parse(input, { context: { ex: 'http://example.org/' } });
                const duration = Math.round(performance.now() - startTime);

                lastParse = { input, result };
                const { quads, context } = result
                delete context['@vocab']

                const writer = new Writer({
                    format: 'Turtle',
                    prefixes: context
                });

                const store = new Store();
                store.addQuads(quads);
                writer.addQuads(store.getQuads())
                writer.end((error, ttlResult) => {
                    const ttlDiv = document.getElementById('ttl');
                    if (error) {
                        ttlDiv.textContent = 'Error: ' + error;
                    } else {
                        ttlDiv.textContent = ttlResult || 'No TTL output generated';
                        // Re-highlight with Prism after content update
                        if (window.Prism) {
                            Prism.highlightElement(ttlDiv);
                        }
                    }
                });

                // Display rendered HTML+RDFa (only if enabled)
                if (ENABLE_RDFA_RENDER) {
                    const renderedResult = render(input, { context: { ex: 'http://example.org/' } });
                    rendered.innerHTML = `<div style="background: white; padding: 1rem; border-radius: 4px;">${renderedResult.html}</div>`;
                }

                // Convert quads to readable format
                output.innerHTML = quadsToHtml(result.quads);
                stats.textContent = `${result.quads.length} triples ‚Ä¢ ${duration}ms`;

                quadLabReset();
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
                if (ENABLE_RDFA_RENDER) {
                    rendered.textContent = `Error: ${error.message}`;
                }
                stats.textContent = '';
                quadLabReset();
            }
        };

        function quadsToHtml(quads) {
            if (!quads || quads.length === 0) return '<div style="color: var(--text-muted);"># No quads generated</div>';
            return quads.map(q => {
                const ctx = lastParse?.result?.context || {};
                const sFull = q.subject.value;
                const pFull = q.predicate.value;
                const sDisp = sFull; // Show raw IRI instead of shortened
                const pDisp = pFull; // Show raw IRI instead of shortened

                const s = chip('S', sFull, sDisp, 'q-s');
                const p = chip('P', pFull, pDisp, 'q-p');

                let o;
                if (q.object.termType === 'Literal') {
                    o = chip('L', formatLiteral(q.object), formatLiteral(q.object), 'q-lit');
                } else {
                    const oFull = q.object.value;
                    const oDisp = oFull; // Show raw IRI instead of shortened
                    o = chip('O', oFull, oDisp, 'q-o');
                }

                return `<div style="display: flex; gap: .4rem; align-items: center; padding: .2rem 0; border-bottom: 1px dashed var(--border-dark); min-width: 0;">${s}<span style="color: var(--text-separator);">‚Üí</span>${p}<span style="color: var(--text-separator);">‚Üí</span>${o}</div>`;
            }).join('');
        }

        // Format literal with datatype/language
        function formatLiteral(literal) {
            let value = literal.value.replace(/"/g, '\\"');
            let result = `"${value}"`;

            if (literal.language) {
                result += `@${literal.language}`;
            } else if (literal.datatype && literal.datatype.value && literal.datatype.value !== 'http://www.w3.org/2001/XMLSchema#string') {
                result += `^^<${literal.datatype.value}>`;
            }

            return result;
        }

        // Clear playground
        window.clearPlayground = function () {
            document.getElementById('input').value = '';
            document.getElementById('output').textContent = 'Quads will appear here...';
            if (ENABLE_RDFA_RENDER) {
                document.getElementById('rendered-output').textContent = 'Rendered HTML will appear here...';
            }
            document.getElementById('parse-stats').textContent = '';
            document.getElementById('quadlab-body').innerHTML = '';
            document.getElementById('quadlab-diff').textContent = 'Diff will appear here...';
            document.getElementById('quadlab-stats').textContent = '';
        };

        function normalizeQuadFromFields(s, p, oField) {
            const S = String(s || '').trim();
            const P = String(p || '').trim();
            const O = parseObjectField(oField);
            if (!S || !P || !O) return null;
            return { subject: { termType: 'NamedNode', value: S }, predicate: { termType: 'NamedNode', value: P }, object: O, graph: { termType: 'NamedNode', value: '' } };
        }

        function quadToRow(quad, idx) {
            const tr = document.createElement('tr');
            tr.dataset.idx = String(idx);
            const oField = quad.object.termType === 'Literal' ? formatLiteral(quad.object) : `<${quad.object.value}>`;
            tr.innerHTML = `
                <td><input type="checkbox" data-role="sel" /></td>
                <td><input data-role="s" value="${escapeHtml(quad.subject.value)}" style="width: 100%; background: var(--bg-input); color: var(--text-code); border: 1px solid var(--border-dark); border-radius: 4px; padding: .25rem .4rem; font-family: var(--font-mono); font-size: 12px;" /></td>
                <td><input data-role="p" value="${escapeHtml(quad.predicate.value)}" style="width: 100%; background: var(--bg-input); color: var(--text-code); border: 1px solid var(--border-dark); border-radius: 4px; padding: .25rem .4rem; font-family: var(--font-mono); font-size: 12px;" /></td>
                <td><input data-role="o" value="${escapeHtml(oField)}" style="width: 100%; background: var(--bg-input); color: var(--text-code); border: 1px solid var(--border-dark); border-radius: 4px; padding: .25rem .4rem; font-family: var(--font-mono); font-size: 12px;" /></td>
            `;
            tr.addEventListener('input', () => quadLabUpdateDiff());
            tr.addEventListener('change', () => quadLabUpdateDiff());
            return tr;
        }

        function quadLabGetRows() {
            const rows = [...document.querySelectorAll('#quadlab-body tr')];
            return rows.map(tr => {
                const s = tr.querySelector('[data-role="s"]').value;
                const p = tr.querySelector('[data-role="p"]').value;
                const o = tr.querySelector('[data-role="o"]').value;
                return normalizeQuadFromFields(s, p, o);
            }).filter(Boolean);
        }

        function quadLabDiffFrom(last, next) {
            const lastMap = new Map((last || []).map(q => [quadKey(q), q]));
            const nextMap = new Map((next || []).map(q => [quadKey(q), q]));
            const del = [];
            const add = [];
            for (const [k, q] of lastMap) if (!nextMap.has(k)) del.push(q);
            for (const [k, q] of nextMap) if (!lastMap.has(k)) add.push(q);
            return { delete: del, add };
        }

        window.quadLabReset = function () {
            const body = document.getElementById('quadlab-body');
            body.innerHTML = '';
            const base = lastParse?.result?.quads || [];
            base.forEach((q, i) => body.appendChild(quadToRow(q, i)));
            quadLabUpdateDiff();
        };

        window.quadLabAddRow = function () {
            const body = document.getElementById('quadlab-body');
            const idx = body.children.length;
            const empty = {
                subject: { termType: 'NamedNode', value: 'http://example.org/s' },
                predicate: { termType: 'NamedNode', value: 'http://www.w3.org/2000/01/rdf-schema#label' },
                object: { termType: 'Literal', value: 'value', language: '', datatype: { termType: 'NamedNode', value: 'http://www.w3.org/2001/XMLSchema#string' } },
                graph: { termType: 'NamedNode', value: '' }
            };
            body.appendChild(quadToRow(empty, idx));
            quadLabUpdateDiff();
        };

        window.quadLabDeleteSelected = function () {
            const body = document.getElementById('quadlab-body');
            [...body.querySelectorAll('tr')].forEach(tr => {
                const sel = tr.querySelector('[data-role="sel"]');
                if (sel?.checked) tr.remove();
            });
            quadLabUpdateDiff();
        };

        function quadLabUpdateDiff() {
            const diffBox = document.getElementById('quadlab-diff');
            const stats = document.getElementById('quadlab-stats');
            const base = lastParse?.result?.quads || [];
            const next = quadLabGetRows();
            const diff = quadLabDiffFrom(base, next);
            const payload = { delete: diff.delete, add: diff.add };
            diffBox.textContent = JSON.stringify(payload, null, 2);
            stats.textContent = `${next.length} quads ‚Ä¢ +${diff.add.length} / -${diff.delete.length}`;
        }

        window.quadLabCopyDiff = async function () {
            const text = document.getElementById('quadlab-diff').textContent || '';
            try {
                await navigator.clipboard.writeText(text);
            } catch {
                // ignore
            }
        };

        window.quadLabApplyDiff = function () {
            if (!lastParse?.result?.origin) return;
            const inputEl = document.getElementById('input');
            const base = lastParse.result.quads || [];
            const next = quadLabGetRows();
            const diff = quadLabDiffFrom(base, next);

            const patched = applyDiff({
                text: inputEl.value,
                diff,
                origin: lastParse.result.origin,
                options: { context: lastParse.result.context }
            });

            inputEl.value = patched.text;
            parseMDLD();
        };

        window.toggleQuadLab = function () {
            const el = document.getElementById('quadlab');
            if (!el) return;
            el.classList.toggle('hidden');
        };

        // Run all tests
        window.runAllTests = async function () {
            const startTime = performance.now();
            currentTestResults = [];

            const progress = document.getElementById('test-progress');
            const progressBar = document.getElementById('test-progress-bar');
            const stats = document.getElementById('test-stats');
            const testList = document.getElementById('test-list');
            const status = document.getElementById('test-status');

            progress.style.display = 'block';
            stats.style.display = 'grid';
            testList.innerHTML = '';
            status.textContent = 'Running tests...';

            let passed = 0;
            let failed = 0;

            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                const testStart = performance.now();

                try {
                    const result = test.fn();
                    const duration = Math.round(performance.now() - testStart);

                    currentTestResults.push({
                        name: test.name,
                        status: 'passed',
                        duration,
                        result
                    });

                    passed++;
                    addTestItem(test.name, 'passed', duration, result);
                } catch (error) {
                    const duration = Math.round(performance.now() - testStart);

                    currentTestResults.push({
                        name: test.name,
                        status: 'failed',
                        duration,
                        error: error.message
                    });

                    failed++;
                    addTestItem(test.name, 'failed', duration, null, error.message);
                }

                const progressPercent = ((i + 1) / tests.length) * 100;
                progressBar.style.width = `${progressPercent}%`;

                document.getElementById('passed-count').textContent = passed;
                document.getElementById('failed-count').textContent = failed;
                document.getElementById('total-count').textContent = tests.length;

                await new Promise(resolve => setTimeout(resolve, 5));
            }

            const totalDuration = Math.round(performance.now() - startTime);
            document.getElementById('duration').textContent = `${totalDuration}ms`;

            setTimeout(() => {
                progress.style.display = 'none';
                status.textContent = `Completed: ${passed} passed, ${failed} failed`;
            }, 500);
        };

        // Add test item to UI
        function addTestItem(name, status, duration, result, error = null) {
            const testList = document.getElementById('test-list');
            const item = document.createElement('div');

            let borderLeft = 'none';
            if (status === 'passed') {
                borderLeft = '3px solid var(--color-success)';
            } else if (status === 'failed') {
                borderLeft = '3px solid var(--color-error)';
            }

            item.style.cssText = `background: var(--bg-feature); border: 1px solid var(--border-dark); border-radius: 4px; padding: .75rem; margin-bottom: .25rem; transition: all .2s; border-left: ${borderLeft};`;

            const icon = status === 'passed' ? '‚úÖ' : '‚ùå';

            item.innerHTML = `
        <div style="display: flex; align-items: center; gap: .5rem; margin-bottom: .5rem;">
          <span style="font-size: 1rem;">${icon}</span>
          <span style="flex: 1; font-weight: 500; font-size: .875rem; font-family: var(--font);">${name}</span>
          <span style="font-size: .75rem; color: var(--text-muted);">${duration}ms</span>
        </div>
        <div style="margin-top: .5rem; padding-top: .5rem; border-top: 1px solid var(--border-dark); display: none;" id="details-${name.replace(/\s+/g, '-')}">
          ${result ? `
            <div style="background: var(--bg-input); padding: .5rem; border-radius: 4px; font-family: var(--font-mono); font-size: 11px; white-space: pre-wrap; max-height: 150px; overflow-y: auto; margin-bottom: .5rem; color: var(--text-code); user-select: text;">${result.input}</div>
            <div style="background: var(--bg-input); padding: .5rem; border-radius: 4px; font-family: var(--font-mono); font-size: 11px; white-space: pre-wrap; max-height: 150px; overflow-y: auto; margin-bottom: .5rem; color: var(--text-code); user-select: text;">${(result.output.quads || []).map(q => `${q.subject.value} -> ${q.predicate.value} -> ${q.object.termType === 'Literal' ? formatLiteral(q.object) : `<${q.object.value}>`}`).join('\n')}</div>
          ` : ''}
          ${error ? `<div style="color: var(--color-error); font-family: var(--font-mono); font-size: 11px;">${error}</div>` : ''}
        </div>
      `;

            item.addEventListener('click', () => {
                const details = item.querySelector(`#details-${name.replace(/\s+/g, '-')}`);
                details.style.display = details.style.display === 'none' ? 'block' : 'none';
            });

            testList.appendChild(item);
        }

        // Clear tests
        window.clearTests = function () {
            currentTestResults = [];
            document.getElementById('test-list').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 1rem;">Click "Run Tests" to see results</p>';
            document.getElementById('test-stats').style.display = 'none';
            document.getElementById('test-progress').style.display = 'none';
            document.getElementById('test-status').textContent = '';
        };

        // Auto-parse on input change
        document.getElementById('input').addEventListener('input', () => {
            clearTimeout(window.parseTimeout);
            window.parseTimeout = setTimeout(parseMDLD, 300);
        });

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                runAllTests();
                loadSpec();
            }, 500);
        });

        // Load initial example
        loadExample('journal');

        // Load and render specification
        async function loadSpec() {
            const specContent = document.getElementById('spec-content');
            const specStatus = document.getElementById('spec-status');

            specStatus.textContent = 'Loading...';
            specContent.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading specification...</p>';

            try {
                const response = await fetch('./docs/Spec/Spec.md');
                if (!response.ok) {
                    throw new Error(`Failed to fetch spec: ${response.status}`);
                }

                const markdown = await response.text();
                const md = new MarkdownIt({
                    html: true,
                    linkify: true,
                    typographer: true,
                    breaks: true
                });

                const html = md.render(markdown);

                // Apply custom styling for the rendered spec
                specContent.innerHTML = `
                    <style>
                        #spec-content h1 { color: var(--accent-orange); border-bottom: 2px solid var(--border-dark); padding-bottom: 0.5rem; margin: 1.5rem 0 1rem 0; }
                        #spec-content h2 { color: var(--text-feature); border-bottom: 1px solid var(--border-dark); padding-bottom: 0.25rem; margin: 1.25rem 0 0.75rem 0; }
                        #spec-content h3 { color: var(--text-feature); margin: 1rem 0 0.5rem 0; }
                        #spec-content h4 { color: var(--text-muted); margin: 0.75rem 0 0.25rem 0; }
                        #spec-content p { margin-bottom: 0.75rem; }
                        #spec-content ul, #spec-content ol { margin: 0.5rem 0 0.75rem 1.5rem; }
                        #spec-content li { margin-bottom: 0.25rem; }
                        #spec-content code { background: var(--bg-input); padding: 0.125rem 0.25rem; border-radius: 3px; font-family: var(--font-mono); font-size: 0.875em; }
                        #spec-content pre { background: var(--bg-input); padding: 0.75rem; border-radius: 4px; overflow-x: auto; margin: 0.75rem 0; }
                        #spec-content pre code { background: none; padding: 0; }
                        #spec-content blockquote { border-left: 3px solid var(--accent-orange); padding-left: 1rem; margin: 0.75rem 0; color: var(--text-muted); font-style: italic; }
                        #spec-content a { color: var(--accent-orange); text-decoration: none; }
                        #spec-content a:hover { text-decoration: underline; }
                        #spec-content table { border-collapse: collapse; width: 100%; margin: 0.75rem 0; }
                        #spec-content th, #spec-content td { border: 1px solid var(--border-dark); padding: 0.5rem; text-align: left; }
                        #spec-content th { background: var(--bg-table-header); color: var(--text-table-header); font-weight: 600; }
                        #spec-content hr { border: none; border-top: 1px solid var(--border-dark); margin: 1.5rem 0; }
                    </style>
                    ${html}
                `;

                specStatus.textContent = 'Specification loaded';

            } catch (error) {
                console.error('Error loading spec:', error);
                specContent.innerHTML = `<p style="text-align: center; color: var(--color-error); padding: 2rem;">Error loading specification: ${error.message}</p>`;
                specStatus.textContent = 'Error loading spec';
            }
        };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-markdown.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-turtle.min.js"></script>

</body>

</html>